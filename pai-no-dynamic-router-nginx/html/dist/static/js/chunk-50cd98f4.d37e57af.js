(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50cd98f4"],{"6d8d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"model-init-container"},[a("div",{staticClass:"header-section"},[a("el-button",{staticClass:"back-button",attrs:{icon:"el-icon-back"},on:{click:t.goBack}},[t._v("返回")]),a("div",{staticClass:"title-section"},[a("h2",{staticClass:"page-title"},[t._v(t._s(t.trainType))]),a("div",{staticClass:"model-info"},[a("span",{staticClass:"model-name"},[t._v(t._s(t.modelInfo.modelName))]),a("span",{staticClass:"model-type"},[t._v(t._s(t.modelInfo.modelType))])])])],1),a("div",{staticClass:"content-container"},[a("el-card",{staticClass:"config-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"el-icon-setting"}),a("span",[t._v("模型配置")])]),0===t.datasetUsage?a("div",{staticClass:"config-form"},[a("el-form",{ref:"configForm",attrs:{model:t.configForm,rules:t.rules,"label-position":"left",size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"分辨率",prop:"resolution"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分辨率"},model:{value:t.configForm.resolution,callback:function(e){t.$set(t.configForm,"resolution",e)},expression:"configForm.resolution"}},t._l(t.resolutionOptions,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"迭代次数",prop:"iterateTimes"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择迭代次数"},model:{value:t.configForm.iterateTimes,callback:function(e){t.$set(t.configForm,"iterateTimes",e)},expression:"configForm.iterateTimes"}},t._l(t.iterationOptions,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"网络结构",prop:"networkStructure"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择网络结构"},model:{value:t.configForm.networkStructure,callback:function(e){t.$set(t.configForm,"networkStructure",e)},expression:"configForm.networkStructure"}},t._l(t.networkStructureOptions,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.key}})})),1)],1),a("el-form-item",{attrs:{label:"优化器",prop:"optimizer"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择优化器"},model:{value:t.configForm.optimizer,callback:function(e){t.$set(t.configForm,"optimizer",e)},expression:"configForm.optimizer"}},t._l(t.optimizerOptions,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.key}})})),1)],1),a("el-form-item",{attrs:{label:"损失函数",prop:"lossValue"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择损失函数"},model:{value:t.configForm.lossValue,callback:function(e){t.$set(t.configForm,"lossValue",e)},expression:"configForm.lossValue"}},t._l(t.lossValueOptions,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.key}})})),1)],1)],1)],1):a("div",{staticClass:"config-display"},[a("div",{staticClass:"config-cards"},[a("el-card",{staticClass:"config-card-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-icon"},[a("i",{staticClass:"el-icon-picture"})]),a("div",{staticClass:"card-title"},[t._v("分辨率")]),a("div",{staticClass:"card-value"},[t._v(t._s(t.configForm.resolution))])]),a("el-card",{staticClass:"config-card-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-icon"},[a("i",{staticClass:"el-icon-refresh"})]),a("div",{staticClass:"card-title"},[t._v("迭代次数")]),a("div",{staticClass:"card-value"},[t._v(t._s(t.configForm.iterateTimes))])]),a("el-card",{staticClass:"config-card-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-icon"},[a("i",{staticClass:"el-icon-connection"})]),a("div",{staticClass:"card-title"},[t._v("网络结构")]),a("div",{staticClass:"card-value"},[t._v(t._s(t.configForm.networkStructure))])]),a("el-card",{staticClass:"config-card-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-icon"},[a("i",{staticClass:"el-icon-setting"})]),a("div",{staticClass:"card-title"},[t._v("优化器")]),a("div",{staticClass:"card-value"},[t._v(t._s(t.configForm.optimizer))])]),a("el-card",{staticClass:"config-card-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-icon"},[a("i",{staticClass:"el-icon-data-line"})]),a("div",{staticClass:"card-title"},[t._v("损失函数")]),a("div",{staticClass:"card-value"},[t._v(t._s(t.configForm.lossValue))])])],1)])]),a("el-card",{staticClass:"dataset-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"el-icon-data-line"}),a("span",[t._v("训练数据集")]),a("el-button",{staticClass:"add-dataset-btn",attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:t.showDatasetDialog}},[t._v(" 添加训练数据 ")])],1),t.selectedDatasets.length>0?a("div",{staticClass:"selected-datasets"},t._l(t.selectedDatasets,(function(e){return a("el-card",{key:e.datasetId,staticClass:"dataset-item",attrs:{shadow:"hover"}},[a("div",{staticClass:"dataset-item-content"},[a("div",{staticClass:"dataset-name"},[t._v(t._s(e.datasetName))]),a("div",{staticClass:"dataset-actions"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-view",circle:"",size:"mini"},on:{click:function(a){return t.viewDatasetDetail(e.datasetId)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(a){return t.removeDataset(e.datasetId)}}})],1)])])})),1):a("div",{staticClass:"empty-tip"},[a("i",{staticClass:"el-icon-data-analysis"}),a("p",[t._v("请添加训练数据集")])]),a("div",{staticClass:"train-actions"},[a("el-button",{attrs:{type:"success",icon:"el-icon-video-play",disabled:!t.canStartTraining},on:{click:t.startTraining}},[t._v(" 开始训练 ")])],1)])],1),a("el-dialog",{attrs:{title:"选择训练数据集",visible:t.datasetDialogVisible,width:"600px"},on:{"update:visible":function(e){t.datasetDialogVisible=e}}},[a("div",{staticClass:"dataset-selection"},[a("el-checkbox-group",{model:{value:t.checkedDatasets,callback:function(e){t.checkedDatasets=e},expression:"checkedDatasets"}},t._l(t.availableDatasets,(function(e){return a("el-checkbox",{key:e.datasetId,staticClass:"dataset-checkbox",attrs:{label:e.datasetId}},[t._v(" "+t._s(e.datasetName)+" ")])})),1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.datasetDialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirmDatasetSelection}},[t._v("确 定")])],1)])],1)},i=[],r=a("5530"),n=a("c7eb"),o=a("1da1"),c=(a("4de4"),a("caad"),a("d81d"),a("e9c4"),a("b64b"),a("d3b7"),a("2532"),a("0643"),a("2382"),a("a573"),a("e56e")),l=a("96bd"),u=a("c356"),d={name:"ModelTrain",data:function(){return{trainType:"",datasetUsage:0,modelInfo:{},resolutionOptions:[],iterationOptions:[],networkStructureOptions:[],optimizerOptions:[],lossValueOptions:[],configForm:{resolution:"",iterateTimes:"",networkStructure:"",optimizer:"",lossValue:""},rules:{resolution:[{required:!0,message:"请选择分辨率",trigger:"change"}],iterateTimes:[{required:!0,message:"请选择迭代次数",trigger:"change"}],networkStructure:[{required:!0,message:"请选择网络结构",trigger:"change"}],optimizer:[{required:!0,message:"请选择优化器",trigger:"change"}],lossValue:[{required:!0,message:"请选择损失函数",trigger:"change"}]},availableDatasets:[],selectedDatasets:[],checkedDatasets:[],datasetDialogVisible:!1,loading:!1}},computed:{canStartTraining:function(){return this.modelConfig?this.selectedDatasets.length>0:this.selectedDatasets.length>0&&this.configForm.resolution&&this.configForm.iterateTimes&&this.configForm.networkStructure&&this.configForm.optimizer&&this.configForm.lossValue}},created:function(){this.initModelInfo(),this.restoreStateIfNeeded()},methods:{initModelInfo:function(){this.modelInfo.modelId=this.$route.query.modelId,this.modelInfo.modelName=this.$route.query.modelName,this.modelInfo.modelType=this.$route.query.modelType,this.modelInfo.lastModelVersion=this.$route.query.lastModelVersion,"0"===this.modelInfo.lastModelVersion?(this.trainType="初始化训练",this.getResolutionOptions(),this.getIterationOptions(),this.getOperatorOptions()):(this.trainType="优化训练",this.getModelConfigInfo(),this.datasetUsage=1)},getResolutionOptions:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["d"])("DATASET_RATIO");case 2:a=e.sent,t.resolutionOptions=a.data||[];case 4:case"end":return e.stop()}}),e)})))()},getIterationOptions:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["d"])("ITERATION_NUMBER");case 2:a=e.sent,t.iterationOptions=a.data||[];case 4:case"end":return e.stop()}}),e)})))()},getOperatorOptions:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["d"])();case 2:a=e.sent,t.networkStructureOptions=a.data[1],t.optimizerOptions=a.data[2],t.lossValueOptions=a.data[3];case 6:case"end":return e.stop()}}),e)})))()},getModelConfigInfo:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,s;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["b"])(t.modelInfo.modelId);case 2:a=e.sent,s=a.data,t.configForm={resolution:s.resolution,iterateTimes:s.iterateTimes,networkStructure:s.networkStructure,optimizer:s.optimizer,lossValue:s.lossValue};case 5:case"end":return e.stop()}}),e)})))()},getAvailableDatasets:function(t){var e=this;return Object(o["a"])(Object(n["a"])().mark((function a(){var s;return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(u["d"])(e.modelInfo.modelId,t);case 2:s=a.sent,e.availableDatasets=s.data||[];case 4:case"end":return a.stop()}}),a)})))()},showDatasetDialog:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading=!0,e.prev=1,0!==t.availableDatasets.length){e.next=5;break}return e.next=5,t.getAvailableDatasets(t.datasetUsage);case 5:t.checkedDatasets=t.selectedDatasets.map((function(t){return t.datasetId})),t.datasetDialogVisible=!0;case 7:return e.prev=7,t.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[1,,7,10]])})))()},confirmDatasetSelection:function(){var t=this;this.selectedDatasets=this.availableDatasets.filter((function(e){return t.checkedDatasets.includes(e.datasetId)})),this.datasetDialogVisible=!1,this.saveCurrentState()},removeDataset:function(t){this.selectedDatasets=this.selectedDatasets.filter((function(e){return e.datasetId!==t})),this.checkedDatasets=this.checkedDatasets.filter((function(e){return e!==t})),this.saveCurrentState()},viewDatasetDetail:function(t){this.saveCurrentState(),this.$router.push({path:"/dataset/detail",query:{datasetId:t}})},saveCurrentState:function(){var t={datasetUsage:this.datasetUsage,modelInfo:this.modelInfo,configForm:this.configForm,selectedDatasets:this.selectedDatasets,checkedDatasets:this.checkedDatasets};sessionStorage.setItem("modelTrainingState",JSON.stringify(t))},restoreStateIfNeeded:function(){var t=sessionStorage.getItem("modelTrainingState");if(t){var e=JSON.parse(t);e.modelInfo&&(this.datasetUsage=e.datasetUsage,this.modelInfo=e.modelInfo,this.configForm=e.configForm,this.selectedDatasets=e.selectedDatasets||[],this.checkedDatasets=e.checkedDatasets||[])}},startTraining:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:0===t.datasetUsage?t.$refs.configForm.validate(function(){var e=Object(o["a"])(Object(n["a"])().mark((function e(a){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:t.submitTrainingTask();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):t.submitTrainingTask();case 1:case"end":return e.stop()}}),e)})))()},submitTrainingTask:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,s;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,a={modelId:t.modelInfo.modelId,datasetIds:t.selectedDatasets.map((function(t){return t.datasetId})),resolution:t.configForm.resolution,iterateTimes:t.configForm.iterateTimes,networkStructure:t.configForm.networkStructure,optimizer:t.configForm.optimizer,lossValue:t.configForm.lossValue},a=0===t.datasetUsage?Object(r["a"])(Object(r["a"])({},a),{},{operationType:1}):Object(r["a"])(Object(r["a"])({},a),{},{operationType:2}),e.next=6,Object(u["f"])(a);case 6:s=e.sent,200===s.code?(t.$message.success("模型训练任务已提交"),sessionStorage.removeItem("modelTrainingState"),t.$router.push({path:"/model/list"})):t.$message.error(s.message||"训练任务提交失败");case 8:return e.prev=8,t.loading=!1,e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()},goBack:function(){this.$router.back()}},beforeDestroy:function(){this.$route.path.includes("/dataset/detail")||sessionStorage.removeItem("modelTrainingState")}},f=d,m=(a("ffa3"),a("2877")),p=Object(m["a"])(f,s,i,!1,null,"62059ac6",null);e["default"]=p.exports},"96bd":function(t,e,a){"use strict";a.d(e,"e",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"f",(function(){return n})),a.d(e,"g",(function(){return o})),a.d(e,"b",(function(){return c})),a.d(e,"a",(function(){return l})),a.d(e,"d",(function(){return u}));a("99af");var s=a("b775");function i(t,e,a){return Object(s["a"])({url:"/operator/".concat(t,"/").concat(e),method:"get",params:a})}function r(t){return Object(s["a"])({url:"/operator/".concat(t),method:"get"})}function n(t){return Object(s["a"])({url:"/operator/import",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}})}function o(t){return Object(s["a"])({url:"/operator",method:"put",data:t})}function c(t){return Object(s["a"])({url:"/operator/".concat(t),method:"delete"})}function l(t){return Object(s["a"])({url:"/operator",method:"delete",data:t})}function u(){return Object(s["a"])({url:"/operator/getDropDownList",method:"get"})}},c356:function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"b",(function(){return r})),a.d(e,"f",(function(){return n})),a.d(e,"a",(function(){return o})),a.d(e,"g",(function(){return c})),a.d(e,"c",(function(){return l})),a.d(e,"e",(function(){return u}));a("99af");var s=a("b775");function i(t,e){return Object(s["a"])({url:"/model/operation/getTrainingDatasets/".concat(t,"/").concat(e),method:"get"})}function r(t){return Object(s["a"])({url:"/model/operation/config/".concat(t),method:"get"})}function n(t){return Object(s["a"])({url:"/model/operation/train",method:"post",data:t})}function o(t){return Object(s["a"])({url:"/model/operation/evaluate",method:"post",data:t})}function c(t,e){return Object(s["a"])({url:"/model/operation/release/".concat(t,"/").concat(e),method:"post"})}function l(){return Object(s["a"])({url:"/model/operation/getReleaseModel",method:"get"})}function u(t,e){var a=new FormData;return a.append("file",e),Object(s["a"])({url:"/model/operation/identify/".concat(t),method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})}},c938:function(t,e,a){},e56e:function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return r})),a.d(e,"e",(function(){return n})),a.d(e,"f",(function(){return o})),a.d(e,"c",(function(){return c})),a.d(e,"d",(function(){return l}));a("99af");var s=a("b775");function i(t){return Object(s["a"])({url:"/dictionary",method:"post",data:t})}function r(t){return Object(s["a"])({url:"/dictionary/".concat(t),method:"get"})}function n(t){return Object(s["a"])({url:"/dictionary",method:"put",data:t})}function o(t){return Object(s["a"])({url:"/dictionary/".concat(t),method:"delete"})}function c(t,e){return Object(s["a"])({url:"/dictionary/".concat(t,"/").concat(e),method:"get"})}function l(t){return Object(s["a"])({url:"/dictionary/getDropDownList/".concat(t),method:"get"})}},e9c4:function(t,e,a){var s=a("23e7"),i=a("d066"),r=a("d039"),n=i("JSON","stringify"),o=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,l=/^[\uDC00-\uDFFF]$/,u=function(t,e,a){var s=a.charAt(e-1),i=a.charAt(e+1);return c.test(t)&&!l.test(i)||l.test(t)&&!c.test(s)?"\\u"+t.charCodeAt(0).toString(16):t},d=r((function(){return'"\\udf06\\ud834"'!==n("\udf06\ud834")||'"\\udead"'!==n("\udead")}));n&&s({target:"JSON",stat:!0,forced:d},{stringify:function(t,e,a){var s=n.apply(null,arguments);return"string"==typeof s?s.replace(o,u):s}})},ffa3:function(t,e,a){"use strict";a("c938")}}]);